# Description
This module implements a distributed messaging system using gRPC and an active replication strategy. In this architecture, a client sends the message to multiple servers simultaneously to ensure data redundancy and fault tolerance.

# Structure 
├── client.py           # Handles sending and receiving data using stubs
├── server.py           # Responds to client requests
├── grpc_messenger/         # Contains files generated by gRPC
    ├── messenger.proto     # gRPC definition file
    ├── compile_proto.sh    # Script to compile the gRPC definition
└── README.md

# Server
## Definição geral
The server defines the Skeleton containing the Send and ReceiveAll methods.

It stores the message queue for incoming data (via the Send method) using a dictionary where the email serves as the key, and message data is appended to a list:

```
self.mailboxes = defaultdict(list)
self.mailboxes[email].append(message)
```

The stored data includes all information received from the client, as defined in the .proto file:

```
message SendRequest {
  int32 id = 1;
  string msg = 2;
  string self_email = 3;
  string dest_email = 4; 
}
```

Upon receiving a ReceiveAll request (equivalent to a "refresh" action in email applications), all data in the queue attached to the requested email is returned to the client, and the queue is subsequently cleared.



## Client

The client initializes and establishes connections with a list of stubs to communicate with multiple servers simultaneously.

It uses a helper method (send_messages) to invoke the Send method on multiple stubs with the same message.

It uses a helper method (receive_all_messages) to invoke the ReceiveAll method on multiple stubs, returning the InboxResponse from all servers. This structure consists of a simple list of messages received by the server and saved in its internal queue. It is defined as:

```
message InboxResponse {
  repeated SendRequest messages = 1;
}
```

Consistency and Fault Tolerance: Ideally, if no server fails, a setup with 3 servers will result in 3 identical copies of the InboxResponse, containing multiple messages in SendRequest format. Otherwise, the system expects that at least one server has successfully received and stored each message sent by the clients.

Data Processing: A helper method (extract_receive_all_unique_responses) extracts unique responses received from all servers (based on matching IDs and source emails). It returns these unique messages for use in other methods, such as displaying them to the user (interface) or saving them to the hard drive (data persistence).



# Developer Information

The structure of this project is highly sensitive to changes in the directory structure (a file belonging to src/comm cannot be moved elsewhere).

Other than that, python files (atleast for comm/ and test/comm_test.py) currently can be executed from anywhere and imported from other scripts without breaking, if the proper sys.path location is provided

## Recompile proto:
**Changing names on proto is extremely prone to breaking! Only do this as developer**
```
sudo chmod +x src/comm/grpc_messager/compile_proto.sh
src/comm/grpc_messager/compile_proto.sh
```

## Start server: 
```
python src/comm/server.py --ip=[::] --port=50051
```

## Start client test:
```
python src/test/comm_test.py
```